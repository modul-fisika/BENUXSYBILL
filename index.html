<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BENUX SYBILL CHATBOT</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
/* Styling tambahan untuk scrollbar */
#chatbox::-webkit-scrollbar {
width: 6px;
}
#chatbox::-webkit-scrollbar-thumb {
background-color: #d1d5db; /* gray-300 */
border-radius: 10px;
}
#chatbox::-webkit-scrollbar-track {
background: #f3f4f6; /* gray-100 */
}
/* Menggunakan font Inter */
body {
font-family: 'Inter', sans-serif;
}
</style>
</head>
<body class="bg-gray-100 items-center justify-center min-h-screen p-4">

<div class="w-full max-w-lg h-[89vh] bg-white rounded-2xl shadow-2xl flex flex-col m-auto">

<header class="p-4 bg-green-600 text-white rounded-t-2xl flex items-center shadow-lg">
<div class="w-10 h-10 bg-white rounded-full flex items-center justify-center mr-3 overflow-hidden border-2 border-green-300">
<!-- Menggunakan placeholder image untuk kompatibilitas single-file -->
<img src="https://placehold.co/40x40/10b981/ffffff?text=B" alt="Benux Avatar" style="object-fit: cover; height: 100%; border-radius: 100%;">
</div>
<div>
<h1 class="text-xl font-extrabold">BENUX SYBILL</h1>
<p class="text-sm text-green-200">Online</p>
</div>
</header>

<!-- Chat Box - Akan diisi oleh JavaScript -->
<div id="chatbox" class="flex-1 p-3 overflow-y-auto space-y-4">
<!-- Pesan akan dimuat di sini -->
</div>

<div class="p-3 border-t border-gray-200 flex flex-col sm:flex-row items-center gap-2">
<input 
id="userInput" 
type="text" 
placeholder="Ketik pesan ente di sini..." 
class="flex-1 p-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500 w-full sm:w-auto"
onkeydown="if(event.key === 'Enter') sendMessage()"
/>
<div class="flex gap-2 w-full sm:w-auto">
<button 
onclick="sendMessage()" 
class="bg-green-500 text-white p-3 rounded-xl hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-400 disabled:bg-green-300 transition-colors flex-1"
id="sendButton"
>
Kirim
</button>
<button 
onclick="clearChat()" 
class="bg-red-500 text-white p-3 rounded-xl hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-400 transition-colors"
title="Hapus seluruh riwayat chat"
>
Hapus Chat
</button>
</div>
</div>
</div>


<footer class="mt-3 text-center text-gray-500">Â© Powered by HIBIKUN AI</footer>

<script>
const chatbox = document.getElementById("chatbox");
const userInput = document.getElementById("userInput");
const sendButton = document.getElementById("sendButton");
// KEY harus dipertahankan. API Key Anda sudah dipecah.
const API_KEY = "hf_" + "Rbt" + "AUI" + "dzb" + "SUht" + "WI" + "v" + "TMEQW" + "vn" + "BNJ" + "ai" + "JLEJZR"; 

// --- Logika Local Storage dan State ---
const CHAT_STORAGE_KEY = 'benuxSybillChatHistory';
// State dalam memori untuk melacak riwayat obrolan dan menyediakan konteks untuk API
let chatHistory = []; 

/**
Â * Menyimpan riwayat obrolan ke Local Storage.
Â */
function saveChatHistory() {
localStorage.setItem(CHAT_STORAGE_KEY, JSON.stringify(chatHistory));
}

/**
Â * Menambahkan pesan ke DOM. Digunakan oleh loadChatHistory dan addMessage.
Â * @param {string} message - Teks pesan.
Â * @param {string} sender - 'user' atau 'bot'.
Â */
function addMessageToDOM(message, sender) {
const messageElement = document.createElement('div');
const bubbleClass = sender === 'user' 
? 'bg-green-500 text-white p-3 rounded-tl-xl rounded-br-xl rounded-bl-xl max-w-xs shadow break-words'
: 'bg-gray-200 text-gray-800 p-3 rounded-tr-xl rounded-bl-xl rounded-br-xl max-w-xs shadow break-words';
const justifyClass = sender === 'user' ? 'justify-end' : 'justify-start';

messageElement.className = `flex ${justifyClass}`;
messageElement.innerHTML = `<div class="${bubbleClass}"><p>${message}</p></div>`;

chatbox.appendChild(messageElement);
// Scroll ke bawah
chatbox.scrollTop = chatbox.scrollHeight;
}

/**
Â * Menambahkan pesan, memperbarui state, dan menyimpan riwayat.
Â * @param {string} message - Teks pesan.
Â * @param {string} sender - 'user' atau 'bot'.
Â */
function addMessage(message, sender) {
// 1. Tambahkan ke DOM
addMessageToDOM(message, sender);

// 2. Perbarui state memori
chatHistory.push({ text: message, sender: sender });

// 3. Simpan ke Local Storage
saveChatHistory();
}

/**
Â * Memuat riwayat obrolan dari Local Storage dan merendernya.
Â */
function loadChatHistory() {
const storedHistory = localStorage.getItem(CHAT_STORAGE_KEY);
if (storedHistory) {
try {
// Muat history ke state in-memory
chatHistory = JSON.parse(storedHistory);
// Render setiap pesan ke DOM
chatHistory.forEach(msg => {
addMessageToDOM(msg.text, msg.sender); 
});
} catch (e) {
console.error("Error loading chat history:", e);
chatHistory = []; // Reset on error
}
}

// Jika tidak ada riwayat, tambahkan pesan sapaan awal dan simpan
if (chatHistory.length === 0) {
const initialMessage = "Yo, ane Benux Sybill. Salken yo! ðŸ‘‹";
addMessage(initialMessage, 'bot'); // Ini akan memanggil addMessage yang otomatis menyimpan
}
}

/**
Â * Menghapus semua riwayat obrolan.
Â */
function clearChat() {
if (!confirm('Yakin mau hapus semua riwayat chat sama Benux, Nte?')) {
return;
}
localStorage.removeItem(CHAT_STORAGE_KEY);
chatHistory = []; // Reset state
chatbox.innerHTML = ''; // Kosongkan DOM

// Tambahkan kembali pesan awal
const initialMessage = "Yo, ane Benux Sybill. Salken yo! ðŸ‘‹";
addMessage(initialMessage, 'bot');
}

// Mengirim pesan dari pengguna, mendapatkan balasan dari API, dan menjaga konteks.
async function sendMessage() {
const query = userInput.value.trim();

if (!query) {
return;
}

// 1. Tampilkan pesan pengguna (ini juga menyimpan history)
addMessage(query, 'user');

// 2. Persiapkan pesan untuk API, termasuk seluruh riwayat
// Catatan: API menggunakan role 'assistant' bukan 'bot'
const messagesForAPI = [
{
role: "system", 
content: "Kamu adalah Benuk Sybill atau Benuk atau Benux atau Nuk. Seorang wota yang kasar, sensual, suka film dewasa, pecinta Bahlil dan mengoshikan Lana JKT48. Memakai bahasa gaul 'ane - ente', serta bisa berbahasa jawa medhok. Balas dengan singkat, padat, dan sesuai karakter."
},
// Masukkan riwayat chat (kecuali pesan sistem pertama yang sudah ada di history)
...chatHistory.map(msg => ({
role: msg.sender === 'user' ? 'user' : 'assistant',
content: msg.text
})),
];

userInput.value = ''; // Kosongkan input

// 3. Tampilkan indikator mengetik
const typingIndicator = document.createElement('div');
typingIndicator.id = 'typingIndicator';
typingIndicator.className = 'flex justify-start';
typingIndicator.innerHTML = `
<div class="bg-gray-200 text-gray-500 p-3 rounded-tr-xl rounded-bl-xl rounded-br-xl max-w-xs shadow italic">
<p>Benux mengetik...</p>
</div>
`;
chatbox.appendChild(typingIndicator);
chatbox.scrollTop = chatbox.scrollHeight;

// Nonaktifkan input dan tombol saat menunggu balasan
userInput.disabled = true;
sendButton.disabled = true;

try {
const response = await fetch("https://router.huggingface.co/v1/chat/completions", {
method: "POST",
headers: {
"Content-Type": "application/json",
"Authorization": "Bearer " + API_KEY
},
body: JSON.stringify({
model: "MiniMaxAI/MiniMax-M2:novita", 
messages: messagesForAPI, // Menggunakan seluruh riwayat untuk konteks
max_tokens: 1500,
temperature: 0.85
})
});

// Hapus indikator mengetik
typingIndicator.remove();

const data = await response.json();
const answer = data.choices && data.choices[0] && data.choices[0].message?.content 
? data.choices[0].message.content 
: "Wah, ane lagi sibuk ngurus tiket Lana. Coba lagi ntar.";

// 4. Tampilkan balasan bot (ini juga menyimpan history)
addMessage(answer, 'bot');

} catch (error) {
console.error("Kesalahan API:", error);
// Hapus indikator mengetik
typingIndicator.remove();
// Gunakan addMessageToDOM agar error tidak tersimpan di history
addMessageToDOM("Duh, koneksi ane ke teater putus. Atau coba periksa koneksi ente.", 'bot');
} finally {
// Aktifkan kembali input dan tombol
userInput.disabled = false;
sendButton.disabled = false;
userInput.focus(); // Fokuskan kembali ke input
}
}

// Muat riwayat obrolan saat halaman dimuat
window.onload = loadChatHistory;
</script>

</body>
</html>
